{% extends "base.html" %}

{% block style%}

{% endblock %}

{% block title %} - {{ set_name }}{% endblock %}


{% block main %}
<div class="content">
    <div style="margin: 20px;">
        <h1>There are {{ total }} cards in {{ set_name }} for a total market value of <span class="price">{{ total_price }}</span>(per tcgplayer): </h1>
    </div>
    <div style="margin: 40px;">
        <div class="flex-container" style="display: flex; flex-wrap: wrap; box-sizing: border-box; justify-content: center;">
            {% for card in all_cards %}
            <div class="flex-item">
                <div style="margin: 10px">
                    <img src="{{ card.images.small }}" alt="{{ card.name }}" style="max-width: 100%; cursor: zoom-in;" data-bs-toggle="tooltip" data-bs-placement="right" title="Market Value: {{ card.market_price }}" onclick="openModal(this.src, this.width)">
                    <div style="text-align: center;">
                        <p style="padding: 10px;">{{ card.name }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
     <!-- Modal that will show the enlarged image -->
     <div id="imageModal" onclick="closeModal()">
         <span id="closeButton">&times;</span>
         <img id="modalContent" src="" alt="Enlarged Image">
     </div>
</div>
         <!-- Link to the external JavaScript file -->
     <script >
        //initialize tooltips
        // Initialize Bootstrap tooltips
        document.addEventListener('DOMContentLoaded', function() {
            const tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            tooltips.forEach(tooltip => {
                new bootstrap.Tooltip(tooltip, {
                    placement: 'right', // Tooltip appears above the image
                    trigger: 'hover'  // Show on hover (default)
                });
            });
        });
        //modal functions
        function openModal(src, width) {
            // Set the source of the modal content to the clicked image
            document.getElementById('modalContent').src = src;
            // Enlargement using the passed width
            if (width) {
                document.getElementById('modalContent').style.width = (width * 1.75) + 'px'; // 1.5x enlargement
            } else {
                document.getElementById('modalContent').style.width = '600px'; // fallback
            }
            // Display the modal
            document.getElementById('imageModal').style.display = "block";
        }

        function closeModal() {
            // Hide the modal when clicked
            document.getElementById('imageModal').style.display = "none";
        }

        // Optionally, close modal if clicked outside the image
        window.onclick = function(event) {
            if (event.target === document.getElementById('imageModal')) {
                closeModal();
            }
        }

        //Format for currency
        // Format all elements with class 'price'
        document.querySelectorAll('.price').forEach(element => {
            const value = parseFloat(element.textContent);
            element.textContent = value.toLocaleString('en-US', {
                style: 'currency',
                currency: 'USD'
            });
        });
     </script>
{% endblock %}
